#!/usr/bin/env python

import argparse
import sys
import signal
import logging

def sigint_handler(dmm):
    def actual_handler(sig, frame):
        logging.info("Stopping DMM (received SIGINT)")
        sys.exit(0)
    return actual_handler

cli = argparse.ArgumentParser(description="Rucio-SENSE data movement manager")
cli.add_argument(
    "--loglevel", type=str, default="INFO", 
    help="log level: DEBUG, INFO, WARNING (default), or ERROR"
)
cli.add_argument(
    "--logfile", type=str, default="dmm.log", 
    help="path to log file (default: ./dmm.log)"
)
args = cli.parse_args()

# Configure logging
logging.basicConfig(
    format="(%(threadName)s) [%(asctime)s] %(levelname)s: %(message)s",
    datefmt="%m-%d-%Y %H:%M:%S %p",
    level=logging.DEBUG,
    handlers=[logging.FileHandler(filename=args.logfile), logging.StreamHandler(sys.stdout)]
)

if __name__ == "__main__":
    # Start DMM
    from dmm.main.dmm import DMM
    logging.info("Starting DMM")
    dmm = DMM()
    signal.signal(signal.SIGINT, sigint_handler(dmm))
    dmm.start()